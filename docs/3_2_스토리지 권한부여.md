ì˜¤í¼ë ˆì´í„°, ê´€ë¦¬ì, í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ìê°€ ê³µìœ í•  **ê³µìœ  ìŠ¤í† ë¦¬ì§€**

**Azure Cloud Shell**ì—ì„œ ì‚¬ìš©í•˜ë„ë¡ **Azure Storage Account**ì™€ **íŒŒì¼ ê³µìœ (Azure Files)** ë¡œ êµ¬ì„±  

## **3. Azure AD ê¸°ë°˜ RBAC ê¶Œí•œ í• ë‹¹**
Azure AD ê·¸ë£¹ì„ ìƒì„±í•˜ê³ , ì´ë¥¼ Azure Filesì— ì—°ê²°í•˜ì—¬ ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´(RBAC)ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **3.1 ì˜¤í¼ë ˆì´í„°, ê´€ë¦¬ì ì™¸ ê·¸ë£¹ ìƒì„±**
```sh
SUBSCRIPTION_ID=$(az account show --query id --output tsv)
az account set --subscription $SUBSCRIPTION_ID
LOCATION="koreacentral"

STORAGE_ACCOUNT_NAME=akscloudshellstorage
RESOURCE_GROUP=rg-aks-cloudshell
LOCATION=koreacentral

OPERATOR_GROUP="aks-operators"
ADMIN_GROUP="aks-admins"
CLUSTER_MANAGER_GROUP="aks-cluster-managers"
DEVELOPERS_GROUP="aks-developers"

# ê° ê·¸ë£¹ì˜ Object ID ê°€ì ¸ì˜¤ê¸°
OPERATOR_GROUP_OBJECT_ID=$(az ad group show --group aks-operators --query id --output tsv)
ADMIN_GROUP_OBJECT_ID=$(az ad group show --group aks-admins --query id --output tsv)
CLUSTER_ADMIN_GROUP_OBJECT_ID=$(az ad group show --group aks-cluster-admins --query id --output tsv)
DEVELOPER_GROUP_OBJECT_ID=$(az ad group show --group aks-developers --query id --output tsv)

echo "ğŸ”¹ ê·¸ë£¹ ì •ë³´:"
echo "   - ì˜¤í¼ë ˆì´í„°: $OPERATOR_GROUP_OBJECT_ID"
echo "   - ê´€ë¦¬ì: $ADMIN_GROUP_OBJECT_ID"
echo "   - í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ì: $CLUSTER_ADMIN_GROUP_OBJECT_ID"
echo "   - ê°œë°œì: $DEVELOPER_GROUP_OBJECT_ID"
```

### **3.2 ìŠ¤í† ë¦¬ì§€ ê¶Œí•œ ë¶€ì—¬**
Azure Filesì— ëŒ€í•œ `Storage File Data SMB Share Contributor` ì—­í• ì„ í• ë‹¹í•˜ì—¬ ì‚¬ìš©ìê°€ ì½ê¸°/ì“°ê¸°/ì‚­ì œê°€ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

ì½ê¸° ê°€ëŠ¥í•˜ê²Œ í•˜ë ¤ë©´ `Storage File Data SMB Share Reader` ì—­í• ì„ í• ë‹¹í•©ë‹ˆë‹¤.

```sh
# Operator ê·¸ë£¹ì— ì½ê¸° ë° ì“°ê¸° ê¶Œí•œ í• ë‹¹
az role assignment create \
  --assignee $OPERATOR_GROUP_OBJECT_ID \
  --role "Storage File Data SMB Share Contributor" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

## Storage Account ì¡°íšŒ ê¶Œí•œ ì¶”ê°€
az role assignment create \
  --assignee $OPERATOR_GROUP_OBJECT_ID \
  --role "Reader" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

## SMB ë°ì´í„° ì½ê¸° ê¶Œí•œ ì¶”ê°€
az role assignment create \
  --assignee $OPERATOR_GROUP_OBJECT_ID \
  --role "Storage File Data SMB Share Reader" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

## Blob ë°ì´í„° ì½ê¸° ê¶Œí•œ ì¶”ê°€
az role assignment create \
  --assignee $OPERATOR_GROUP_OBJECT_ID \
  --role "Storage Blob Data Reader" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

# Admin ê·¸ë£¹ì— ì½ê¸° ë° ì“°ê¸° ê¶Œí•œ í• ë‹¹
az role assignment create \
  --assignee $ADMIN_GROUP_OBJECT_ID \
  --role "Storage File Data SMB Share Contributor" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

# Owner ê¶Œí•œ í• ë‹¹
## Cluster Admin ê·¸ë£¹ì— ì“°ê¸° ë° ê³µìœ  ê¶Œí•œ í• ë‹¹
az role assignment create \
  --assignee $CLUSTER_ADMIN_GROUP_OBJECT_ID \
  --role "Owner" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

## Cluster Admin ê·¸ë£¹ì— ì“°ê¸° ë° ê³µìœ  ê¶Œí•œ í• ë‹¹
az role assignment create \
  --assignee $CLUSTER_ADMIN_GROUP_OBJECT_ID \
  --role "Storage File Data SMB Share Elevated Contributor" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

## Cluster Admin ê·¸ë£¹ì— ì“°ê¸° ë° ê³µìœ  ê¶Œí•œ í• ë‹¹
az role assignment create \
  --assignee $CLUSTER_ADMIN_GROUP_OBJECT_ID \
  --role "Storage Blob Data Owner" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

# Developer ê¶Œí•œ í• ë‹¹
## Storage Account ì¡°íšŒ ê¶Œí•œ ì¶”ê°€
az role assignment create \
  --assignee $DEVELOPER_GROUP_OBJECT_ID \
  --role "Reader" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

## SMB ë°ì´í„° ì½ê¸° ê¶Œí•œ ì¶”ê°€
az role assignment create \
  --assignee $DEVELOPER_GROUP_OBJECT_ID \
  --role "Storage File Data SMB Share Reader" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

## Blob ë°ì´í„° ì½ê¸° ê¶Œí•œ ì¶”ê°€
az role assignment create \
  --assignee $DEVELOPER_GROUP_OBJECT_ID \
  --role "Storage Blob Data Reader" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

# # ì‚­ì œ
# az role assignment delete \
#   --assignee $OPERATOR_GROUP_OBJECT_ID \
#   --role "Storage File Data SMB Share Contributor"  \
#   --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"
```

> **ì°¸ê³ :** `Storage File Data SMB Share Contributor` ì—­í• ì€ Azure Filesë¥¼ ì‚¬ìš©í•  ë•Œ í•„ìš”í•˜ë©°, ê°œë³„ ì‚¬ìš©ì ë˜ëŠ” ê·¸ë£¹ì˜ **Azure AD Object ID**ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

---



### **ï¿½ï¿½ Azure AD ì¸ì¦ì„ ì‚¬ìš©í•˜ì—¬ ìŠ¤í† ë¦¬ì§€ ê³„ì •ì— ëŒ€í•œ ê¶Œí•œ ë¶€ì—¬**
```bash
az role assignment create \
  --assignee $OPERATOR_GROUP_OBJECT_ID \
  --role "Storage Account Key Operator Service Role" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

az role assignment create \
  --assignee $ADMIN_GROUP_OBJECT_ID \
  --role "Storage Account Key Operator Service Role" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

az role assignment create \
  --assignee $CLUSTER_ADMIN_GROUP_OBJECT_ID \
  --role "Storage Account Key Operator Service Role" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"

az role assignment create \
  --assignee $DEVELOPER_GROUP_OBJECT_ID \
  --role "Storage Account Key Operator Service Role" \
  --scope "/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME"
```